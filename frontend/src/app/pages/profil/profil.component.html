<h2>Mon Profil</h2>

<div class="container mt-5" *ngIf="user; else loading">
  <div *ngIf="!editmode">
    <!-- Dados do usuário -->
    <div class="card p-4 text-center shadow-lg" style="max-width: 400px; margin: auto;">
      <img [src]="'https://localhost:8000/uploads/images/' + user?.imageName"
          alt="Foto do usuário"
          class="rounded-circle mb-3"
          width="120"
          height="120" />
      <h3>{{ user.firstname }} {{ user.lastname }}</h3>
      <p class="text-muted">{{ user.email }}</p>

    </div>
    <button (click)="edit()">Edit</button>
  </div>

  <form *ngIf="editmode" (submit)="submit()">
    <!-- Formulário de edição do perfil -->
    <div class="mb-3">
      <label for="firstname" class="form-label">Prénom</label>
      <input type="text" id="firstname" class="form-control" [(ngModel)]="user.firstname" name="firstname" />
    </div>
    <div class="mb-3">
      <label for="lastname" class="form-label">Nom</label>
      <input type="text" id="lastname" class="form-control" [(ngModel)]="user.lastname" name="lastname" />
    </div>
    <div class="mb-3">
      <label for="email" class="form-label">Email</label>
      <input type="email" id="email" class="form-control" [(ngModel)]="user.email" name="email" />
    </div>

      <input
    type="file"
    id="propertyImages"
    (change)="onFilesSelected($event)"
    accept="image/*"
  />

  <div class="preview-images">
    <img *ngFor="let img of selectedImages" [src]="img" alt="Prévisualisation image" />
  </div>


    <button type="submit" class="btn btn-primary">Save</button>
  </form>

  <button (click)="delete()">Delete</button>
  <button (click)="annuler()">Annuler</button>



  <!-- Propriedades -->
  <h3 class="listings-title mt-4">Mes Propriétés</h3>

  <div *ngIf="user.properties?.length; else noProperties">
    <div *ngFor="let property of user.properties" class="listing-item p-3 mb-4 border rounded shadow-sm">
      <h4>{{ property.title }}</h4>
      <p>{{ property.propertyType }}</p>
      <p>{{ property.listingType }}</p>
      <p>{{ property.description }}</p>
      <p>{{ property.adress }}</p>
      <p>{{ property.totalArea }}</p>
      <p><strong>Prix:</strong> {{ property.price }} €</p>

      <div class="listing-images d-flex gap-2">
        <img *ngFor="let img of property.photos"
             [src]="img"
             alt="Image du bien"
             width="100"
             height="75"
             class="rounded"
             style="object-fit: cover;" />
      </div>
    </div>
  </div>
</div>

<ng-template #loading>
  <div class="text-center mt-5">Chargement du profil...</div>
</ng-template>

<ng-template #noProperties>
  <div class="text-center mt-3">Vous n'avez aucune propriété pour le moment.</div>
</ng-template>

